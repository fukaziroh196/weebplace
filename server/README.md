# Kristal Backend API

Backend сервер для приложения Kristal - аниме платформа с игрой "Угадай аниме".

## Возможности

- ✅ Аутентификация пользователей (регистрация/логин)
- ✅ Роль администратора
- ✅ Загрузка и хранение картинок для игры "Угадай аниме"
- ✅ Система угадывания и подсчет статистики
- ✅ Сохранение библиотек пользователей (просмотренное, избранное и т.д.)
- ✅ JWT токены для безопасности
- ✅ SQLite база данных
- ✅ Загрузка файлов с валидацией
- ✅ CORS поддержка

## Быстрый старт (локально)

```bash
# Установка зависимостей
npm install

# Запуск сервера
npm start

# Или с авто-перезагрузкой
npm run dev
```

Сервер запустится на `http://localhost:3000`

## Структура проекта

```
server/
├── index.js          # Основной файл сервера
├── package.json      # Зависимости
├── API.md            # Документация API
├── DEPLOY.md         # Инструкции по деплою
├── .env.example      # Пример конфигурации
└── uploads/          # Папка для загруженных файлов
```

## Конфигурация

Создайте файл `.env` на основе `.env.example`:

```env
PORT=3000
JWT_SECRET=your-secret-key-here
NODE_ENV=development
```

## API Endpoints

### Публичные
- `POST /api/register` - Регистрация
- `POST /api/login` - Логин
- `GET /api/anime-guesses` - Получить все картинки для угадывания

### Требуют авторизации
- `GET /api/me` - Информация о текущем пользователе
- `POST /api/library` - Сохранить библиотеку
- `GET /api/library` - Получить библиотеку
- `POST /api/anime-guesses/:id/check` - Проверить ответ

### Только для админов
- `POST /api/anime-guesses` - Загрузить картинку
- `DELETE /api/anime-guesses/:id` - Удалить картинку

Подробная документация: [API.md](./API.md)

## База данных

Используется SQLite. База создается автоматически при первом запуске в файле `database.sqlite`.

### Таблицы

**users** - Пользователи
- id, username, password_hash, created_at, is_admin, avatar_url

**anime_guesses** - Картинки для игры
- id, user_id, image_url, title, anime_id, source_id, created_at, guessed_by

**user_libraries** - Библиотеки пользователей
- user_id, data_type, data_content

## Безопасность

- Пароли хэшируются с помощью bcrypt
- JWT токены для аутентификации
- Валидация типов файлов при загрузке
- Ограничение размера файлов (10MB)
- Проверка прав доступа для админ-функций

## Деплой

См. подробную инструкцию в [DEPLOY.md](./DEPLOY.md)

## Лицензия

MIT

